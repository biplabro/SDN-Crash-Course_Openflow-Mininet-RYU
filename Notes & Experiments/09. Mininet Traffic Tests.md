# Mininet Traffic Tests

## 1. TCP/UDP concepts

The flow of traffic across the Internet is on the basis of protocols which are TCP (Transmission Control Protocol) and UDP (User Datagram Protocol)[1]. As data moves along a network, various attributes are added to the file to create a frame. This process is called encapsulation. There are different methods of encapsulation depending on which protocol and topology are being used. As a result, the frame structure of these packets differ as well[2].

![Fig.1 TCP vs UDP frame header](https://github.com/biplabro/SDN-hands-on_Openflow-Mininet-RYU/blob/master/images/header-TCP-vs-UDP.jpg)

Fig.1 TCP vs UDP frame header

**TCP vs UDP protocol: Differences**
|TCP (Transmission Control Protocol)|UDP (User Datagram Protocol)|
|-----------------------------------|----------------------------|
|**Connection oriented**. Establish connection before transmitting data & close connection after the communication is done|**Connection-less** protocol having no compulsion for establishing, maintaining and terminating a connection between nodes|
|TCP transmissions are **sent in a sequence** and they are received in the same sequence. In the event of data segments arriving in wrong order, TCP reorders and delivers application|In the case of UDP, sent message **sequence may not be maintained** when it reaches receiving application. There is absolutely no way of predicting the order in which message will be received.|
|TCP uses both **error detection and error recovery**. Errors are detected via checksum and if a packet is erroneous, it is not acknowledged by the receiver, which triggers a retransmission by the sender.|UDP works on a "best-effort" basis. The protocol supports error detection via checksum but when an error is detected, the packet is discarded. Retransmission of the packet for **recovery from that error is not attempted**[3] |
|TCP is suited for applications that require **high reliability**, and transmission time is relatively less critical|UDP is suitable for applications that need **fast, efficient transmission**, such as games, media streaming etc|
|The speed is **slower** than the UDP.|UDP is **faster** because error recovery is not attempted. It is a "best effort" protocol.|

### 1.1 TCP/UDP Traffic test

**iPerf**
iPerf3 is a tool for active measurements of the maximum achievable bandwidth & **performance testing** on IP networks. It supports tuning of various parameters related to timing, buffers and protocols (TCP, UDP, SCTP with IPv4 and IPv6, HTTP etc). For each test it reports the bandwidth, loss, and other parameters[4]. iPerf tool can be used in figuring out network configuration flaws & making **DoS attacks**[5] to a specific server.
```
ubuntu@ubuntu18-04:~$ iperf --version
iperf version 2.0.10 (2 June 2018) pthreads
ubuntu@ubuntu18-04:~$ 
```
In one host we have to start a TCP server & other host will act as client to communicate with each other. 

**Running a topology with controller**

We will use `ryu controller` & mininet linear topology with 4 hosts in this demo. Separate xterm terminal used for each individual hosts. 
* ryu command: `ryu-manager ryu.app.simple_switch_13`
* mininet command: `sudo mn --controller=remote,ip=127.0.0.1 --mac -i 10.1.1.0/24 --switch=ovsk,protocols=OpenFlow13 --topo=linear,4  -x`
> The trailing `-x` in the above mininet command specifies that each individual network element (controller, switches & hosts) will pop up as a separate xterm window.

**Running iperf server**
initializing tcp server in host-4. command executed in h4 terminal: `iperf -s`. The `s` tells that its a server.

**Running iperf client**
Host-1, 2 & 3 are selected as client & the iperf will try to communicate with h4 using 10.1.1.4 ip address from the respective terminals. 
Commands: 

* `iperf -c 10.1.1.4 -i 2 -t 10` (Host-1)
* `iperf -c 10.1.1.4 -i 2 -t 10 -b 10m` (Host-2)
* `iperf -c 10.1.1.4 -i 2 -t 10 -P 5` (Host-3)

![Fig.2 TCP test iPerf](https://github.com/biplabro/SDN-hands-on_Openflow-Mininet-RYU/blob/master/images/iperf-tcp.png)

Fig.2 TCP test iPerf

|Options|Description|
|-------|-----------|
|`-c` | client mode, specify the server ip (10.1.1.4)|
|`-i` | network statistics report interval (in seconds)|
|`-t` | test duration (in seconds)|
|`-b` | specify communication bandwidth between two nodes (m= megaBits, g= gigaBits)|
|`-P` | number of parallel connections to server|

**Flows of traffic from SDN perspective**
```
ubuntu@ubuntu18-04:~$ sudo ovs-ofctl -O OpenFlow13 dump-flows s1
 cookie=0x0, duration=2518.681s, table=0, n_packets=1851396, n_bytes=122193772, priority=1,in_port="s1-eth2",dl_src=00:00:00:00:00:04,dl_dst=00:00:00:00:00:01 actions=output:"s1-eth1"
 cookie=0x0, duration=2518.680s, table=0, n_packets=2105521, n_bytes=92870764874, priority=1,in_port="s1-eth1",dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:04 actions=output:"s1-eth2"
 cookie=0x0, duration=2881.126s, table=0, n_packets=25, n_bytes=1864, priority=0 actions=CONTROLLER:65535
ubuntu@ubuntu18-04:~$ 
```

**Results**
We can refer to [Mininet Linear Topology](https://github.com/biplabro/SDN-hands-on_Openflow-Mininet-RYU/blob/master/Notes%20%26%20Experiments/08.%20Mininet%20Topologies.md#23-linear-topology).
* `cookie=0x0, duration=2518.680s, table=0, n_packets=2105521, n_bytes=92870764874, priority=1,in_port="s1-eth1",dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:04 actions=output:"s1-eth2"` when the incoming port is `s1-eth1`, source MAC is `00:00:00:00:00:01` **(h1)** and destination MAC is `00:00:00:00:00:04` **(h4)** the packet is forwarded to `s1-eth2` port of switch-1 **(s1)**. The flow is installed & running properly thus we are able to ping the hosts. 




### _References_

```
[1] http://www.differencebetween.net/technology/difference-between-tcp-and-udp/
[2] http://www.skullbox.net/tcpudp.php
[3] https://www.diffen.com/difference/TCP_vs_UDP
[4] https://iperf.fr/
[5] https://stackoverflow.com/questions/46431999/dos-attack-using-iperf-in-the-network
[6] 
[7] 
[8] 
[9] 
[10] 
[11] 
[12] 
```
